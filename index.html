<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gateway</title>
<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#f2f4f8;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}
.box{
    background:#fff;
    padding:36px 32px;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.15);
    text-align:center;
    max-width:520px;
    width:90%;
}
h1{
    margin:0 0 16px;
    font-size:26px;
}
p{
    margin:0;
    color:#555;
    font-size:15px;
}
</style>
</head>
<body>

<div class="box">
    <h1 id="title">ðŸ”„ æ–‡ä»¶è®¿é—®ç½‘å…³</h1>
    <p id="status">æ­£åœ¨æ£€æµ‹ç½‘ç»œçŽ¯å¢ƒâ€¦</p>
</div>

<script>
/* ================== é…ç½® ================== */
const MAIN_SITE = 'http://openlist.å¸acg.xyz'; // åªæœ‰ AAAA
const BACKUPS = [
    'http://1-openlist.å¸acg.xyz',
    'http://2-openlist.å¸acg.xyz',
    'http://3-openlist.å¸acg.xyz'
];
/* ========================================= */

const LANG = (() => {
    const l = (navigator.language || '').toLowerCase();
    if (l.startsWith('zh-tw') || l.startsWith('zh-hk')) return 'tw';
    if (l.startsWith('zh')) return 'cn';
    return 'en';
})();

const TEXT = {
    cn:{
        title:'ðŸ”„ æ–‡ä»¶è®¿é—®ç½‘å…³',
        checking:'æ­£åœ¨æ£€æµ‹ IPv6 ç½‘ç»œâ€¦',
        v6:'IPv6 å¯ç”¨ï¼Œè·³è½¬ä¸»ç«™â€¦',
        v4:'IPv6 ä¸å¯ç”¨ï¼Œé€‰æ‹©å¤‡ç”¨èŠ‚ç‚¹â€¦'
    },
    tw:{
        title:'ðŸ”„ æª”æ¡ˆå­˜å–é–˜é“',
        checking:'æ­£åœ¨æª¢æ¸¬ IPv6 ç¶²è·¯â€¦',
        v6:'IPv6 å¯ç”¨ï¼Œè·³è½‰ä¸»ç«™â€¦',
        v4:'IPv6 ä¸å¯ç”¨ï¼Œé¸æ“‡å‚™ç”¨ç¯€é»žâ€¦'
    },
    en:{
        title:'ðŸ”„ File Gateway',
        checking:'Checking IPv6 connectivityâ€¦',
        v6:'IPv6 available, redirectingâ€¦',
        v4:'IPv6 unavailable, using backupâ€¦'
    }
};

document.getElementById('title').textContent = TEXT[LANG].title;
document.getElementById('status').textContent = TEXT[LANG].checking;

const path =
    location.pathname +
    location.search +
    location.hash;

function checkIPv6() {
    return new Promise(resolve => {
        const img = new Image();
        let finished = false;

        img.onload = () => {
            if (!finished) {
                finished = true;
                resolve(true);
            }
        };

        img.onerror = () => {
            if (!finished) {
                finished = true;
                resolve(false);
            }
        };

        img.src = MAIN_SITE + '/favicon.ico?_' + Date.now();

        setTimeout(() => {
            if (!finished) {
                finished = true;
                resolve(false);
            }
        }, 2000);
    });
}

function pickBackup(){
    return BACKUPS[Math.floor(Math.random()*BACKUPS.length)];
}

(async ()=>{
    const ok = await checkIPv6();
    const status = document.getElementById('status');

    let target;
    if(ok){
        status.textContent = TEXT[LANG].v6;
        target = MAIN_SITE;
    }else{
        status.textContent = TEXT[LANG].v4;
        target = pickBackup();
    }

    setTimeout(()=>{
        location.replace(target + path);
    },600);
})();
</script>

</body>
</html>